从去年8月中旬第一次听说lotus，9月底太空竞赛2正式开始filecoin相关工作，除开机房的一位硬件同事，一个人运维公司的小矿池已经有4个月了。

这期间经历了什么？

- 不同的优化版本。filecoin的挖矿很特别，堪称最难挖，btc/eth这些只需要计算，多的在消耗点内存，想开机就开机，想关机就关机，大不了没啥收益，去中心化存储要存数据，且高可靠的访问，存的数据又大，不可能搬到链上，又整出来了零知识证明，可复制证明，时空证明这一套，过不了还要被惩罚。官方的代码效率差，于是来得早的矿工普遍自己优化了官方的代码，我们来得晚，就买了别人的优化版跑，但是不同的开发者理念不一样，对硬件的适配也不一样，到现在我们的机器都没有一个统一的配置。总之，不同的版本，运维的方式理念也大不一样，都要去学习，请教优化版的运维/开发。
- 不同的链。最开始是filecoin，但是我们来得太晚了，9月底才刚上路，10月15号主网就上线了，还没积累多少存力，测试网补偿fil的时代就过去了。于是也跑去挖了两个分叉项目filecash和filestar，效果还不错，就是币价越来越低，收益越来越少了。然后听说了波卡体系，也有去中心化存储项目crust，虽然已经过了早期的测试网，但主网还没上线，可搞，又听说了隐私计算项目phala，这个不耗存储，都是利用了CPU的TEE技术，那是不是可以一台机器上双挖？最近就正在弄
- 单日算力不达标。差不多的硬件配置，为何别人说能一天2T，我们只有1.2 1.4 1.7这种，各个机器不大相同但却都偏低，如何估算各个worker算力也是个问题。跑bench单并发其实很棒，但是并发数一增多效率就降，最后瞄准了SSD，有的SSD驱动不是最新的，有的SSD杂牌货就是不行，看得出来进货的时候缺乏测试
- 存储。存储太重要了，只要存储机的数据不丢，你就有办法恢复miner，当做大量封装的时候会并发写入，当时空证明的时候半个小时要完成2349个扇区的证明，读的压力也打。可靠性读写性能全都要。存储机做了raid5，坏过一次盘，直接把整台机器的读写性能带崩了，最后把写入关闭，清理了少量空间不能让整个raid空间写满，然后恢复了十来天，这期间各种时空证明不过。也尝试过裸盘，也尝试了7牛云的对象存储（7牛的三台存储机做的分布式存储坏了一台，导致我的第一次掉分区惩罚，33个FiL），也在考察其它大公司提供的分布式存储方案，还没有定论
- 本地数据库损坏。这个当时一度以为要GG了，当时在做有效存储的交易，每一个达成deal的交易都会把数据写成tmp文件放到miner的文件路径中，结果有一次导入太多交易，还没来得及封装完然后程序删除这些tmp文件，就把磁盘撑爆了，然后本地leveldb数据库损坏了，miner起不起来，最后放弃了当前的db重新初始化了一个miner，等于之前所有的本地数据都丢了，还好存储没掉。
- 链。有时候lotus的同步莫名其妙会掉，需要重新同步，我们用的看都是SSD，都没用hdd；随着链的增长，数据量越来越大，filecoin这个特别大，人家比特币以太坊几年下来也才几百个G，这filecoin两个月就上T了，没办反，做裁剪的快照然后重新导入。
- 官方bug。比如整个链暂停出块几个小时。早上醒来一看微信好多条消息，几个早上做时空证明的miner全没过，还好官方修复及时。
- gas gas gas。消息堵了，又堵了，不想说了，真的难受，几乎所有的矿工都在封装随机数--“垃圾“数据，随之的垃圾数据的封装消息上链，把整个网络弄堵了，然后basefee就上去了，连带着时空证明消息的gas费一天都要好几个fil，大矿工一天几十个。真的无语了，这还是filecoin的初衷吗？
- 有效数据。弹弓一弹弓二我们都参加了，弹弓一内存泄露，封一段时间就要崩，为此新建了两个小节点一起弄，弹弓二规则单个miner不能存储超过30%的数据量，又新建了一个小miner。交易都是自个儿给自个儿的mienr发，还有到底什么算10倍算力，看官方的推进吧。
- 交互应用。正在弄一个转币的接口服务，还可以做更多的。

大致就说这么多吧，上面这些算是主要旋律，这算是我的第一次运维工作，写了一些脚本，也尝试了ansible，不过主旋律还是人肉运维，还好机器不算多不到100台。

我觉得目前我还是不是一个合格的运维（而且我当时来这里的目的做区块链开发的，但运维现在吃掉了我大部分的精力），为什么标题是瞎子：

- 源码之前了无秘密。找问题的时候看了很多日志，也查阅了一些代码，但总体而言仍是九牛一毛。
- 监控告警系统。11月份抽时间网上看了不少的文章，了解了devops概念，就决定用Prometheus体系了，结果断断续续拖了好久，还要加上一套日志监控告警系统应该就完整了吧。而且现在我们的节点存力不大还不到1PB，以后搞个10PB大节点每半个小时一次时空证明，没有监控系统是玩不转的。

所以有了现在这篇bolg，是要敦促我自己不管怎么安排时间，都要尽快拿下这两个点，让自己不再是个瞎子。

